{"createdAt":"2025-04-21T02:32:07.036Z","updatedAt":"2025-04-30T08:43:38.000Z","id":"BcLRdJU0QIn1UcpJ","name":"PMS Bot Slash Command","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"=jira-status","options":{"responseData":""}},"id":"81c2a3ac-e9fc-44bd-af4a-fc5a8fd4f851","name":"Slack jira_status Webhook","type":"n8n-nodes-base.webhook","position":[640,-320],"webhookId":"78214945-1731-46ca-a13f-132df9ee1d14","typeVersion":2},{"parameters":{"operation":"getAll","returnAll":true,"options":{"jql":"={{`assignee IN (${$node[\"Slack jira_status Webhook\"].json.body.text}) AND issuetype IN (Story, Bug) AND statusCategory != Done`}}"}},"name":"Jira Search","type":"n8n-nodes-base.jira","typeVersion":1,"position":[860,-320],"id":"ef9400e9-a4b0-4d37-84b6-dd2ecdda9fc0","credentials":{"jiraSoftwareCloudApi":{"id":"jd9f8LcXIUpGLHG7","name":"Colo Developjik1 Jira SW Cloud account"}}},{"parameters":{"jsCode":"// 데이터 가져오기\nconst items = $input.all();\nlet jiraIssues = [];\n\n// 아이템에서 이슈 데이터 수집\nif (items?.length > 0) {\n  jiraIssues = items.filter(item => item.json).map(item => item.json);\n}\n\n// JIRA 도메인 설정 (링크용)\nconst JIRA_DOMAIN = 'https://your-domain.atlassian.net'; // 여기에 실제 JIRA 도메인 입력\n\n// 상태별 분류\nconst inProgressIssues = jiraIssues.filter(issue => \n  issue.fields?.statusCategory?.key === 'indeterminate'\n);\nconst todoIssues = jiraIssues.filter(issue => \n  issue.fields?.statusCategory?.key === 'new'\n);\n\n// 날짜 포맷팅\nconst today = new Date();\nconst formattedDate = `${today.getFullYear()}년 ${today.getMonth() + 1}월 ${today.getDate()}일`;\n\n// 우선순위 이모지 매핑\nconst priorityEmojis = {\n  'Highest': '🔴',\n  'High': '🟠',\n  'Medium': '🟡',\n  'Low': '🟢',\n  'Lowest': '🔵'\n};\n\n// 이슈 타입 이모지 매핑\nconst issueTypeEmojis = {\n  'Bug': '🐞',\n  'Story': '📜',\n  'Task': '📋',\n  'Epic': '🏆',\n  'Sub-task': '📎'\n};\n\n// 이슈 블록 생성 함수\nconst createIssueBlock = (issue, index) => {\n  const blocks = [];\n  const issueType = issue.fields?.issuetype?.name || 'Task';\n  const priorityEmoji = issue.fields?.priority?.name ? \n    (priorityEmojis[issue.fields.priority.name] || '⚪️') : '⚪️';\n  const typeEmoji = issueTypeEmojis[issueType] || '📄';\n  \n  // 이슈 링크 생성\n  const issueLink = `${JIRA_DOMAIN}/browse/${issue.key}`;\n  \n  // 이슈 제목과 간단 정보  \n  blocks.push({\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": `*${index+1}. <${issueLink}|${issue.key}>* ${typeEmoji} ${priorityEmoji} *${issue.fields.summary}*`\n    }\n  });\n  \n  // 상태, 우선순위, 담당자 정보\n  const assigneeName = issue.fields?.assignee?.displayName || '미배정';\n  const statusName = issue.fields?.status?.name || '상태없음';\n  const priorityName = issue.fields?.priority?.name || '우선순위없음';\n  \n  blocks.push({\n    \"type\": \"context\",\n    \"elements\": [\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `• 상태: *${statusName}* • 우선순위: *${priorityName}* • 담당자: *${assigneeName}*`\n      }\n    ]\n  });\n  \n  // 이슈에 설명이 있다면 짧게 표시 (선택사항)\n  if (issue.fields?.description && issue.fields.description.length > 0) {\n    let description = issue.fields.description;\n    // 설명이 너무 길면 잘라내기\n    if (description.length > 100) {\n      description = description.substring(0, 97) + '...';\n    }\n    \n    blocks.push({\n      \"type\": \"context\",\n      \"elements\": [\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `💬 ${description}`\n        }\n      ]\n    });\n  }\n  \n  return blocks;\n};\n\n// Slack Block Kit 메시지 생성\nconst slackBlocks = [\n  // 헤더 섹션\n  {\n    \"type\": \"header\",\n    \"text\": {\n      \"type\": \"plain_text\",\n      \"text\": `📊 JIRA 작업 현황 보고 (${formattedDate} 기준)`,\n      \"emoji\": true\n    }\n  },\n  { \"type\": \"divider\" },\n  \n  // 진행 중인 작업 섹션\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": `*🔶 진행 중인 작업 (IN PROGRESS)* - 총 ${inProgressIssues.length}건`\n    }\n  }\n];\n\n// 진행 중인 작업 목록 추가\nif (inProgressIssues.length === 0) {\n  slackBlocks.push({\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": \"📭 진행 중인 작업이 없습니다.\"\n    }\n  });\n} else {\n  inProgressIssues.forEach((issue, index) => {\n    // 이슈 블록 생성 및 추가\n    const issueBlocks = createIssueBlock(issue, index);\n    slackBlocks.push(...issueBlocks);\n    \n    // 구분선 추가 (마지막 항목 제외)\n    if (index < inProgressIssues.length - 1) {\n      slackBlocks.push({ \"type\": \"divider\" });\n    }\n  });\n}\n\n// 할 작업 섹션 헤더\nslackBlocks.push(\n  { \"type\": \"divider\" },\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": `*🔷 앞으로 할 작업 (TO DO)* - 총 ${todoIssues.length}건`\n    }\n  }\n);\n\n// 할 작업 목록 추가\nif (todoIssues.length === 0) {\n  slackBlocks.push({\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": \"📭 할 작업이 없습니다.\"\n    }\n  });\n} else {\n  todoIssues.forEach((issue, index) => {\n    // 이슈 블록 생성 및 추가\n    const issueBlocks = createIssueBlock(issue, index);\n    slackBlocks.push(...issueBlocks);\n    \n    // 구분선 추가 (마지막 항목 제외)\n    if (index < todoIssues.length - 1) {\n      slackBlocks.push({ \"type\": \"divider\" });\n    }\n  });\n}\n\n// 요약 정보 섹션\nslackBlocks.push(\n  { \"type\": \"divider\" },\n  {\n    \"type\": \"header\",\n    \"text\": {\n      \"type\": \"plain_text\",\n      \"text\": \"📌 요약\",\n      \"emoji\": true\n    }\n  },\n  {\n    \"type\": \"section\",\n    \"fields\": [\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*전체 작업:*\\n${jiraIssues.length}건`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*진행 중:*\\n${inProgressIssues.length}건`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*할 작업:*\\n${todoIssues.length}건`\n      }\n    ]\n  },\n  // 바닥글 - 보고서 생성 정보\n  {\n    \"type\": \"context\",\n    \"elements\": [\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `⏱️ 보고서 생성 시간: ${new Date().toLocaleTimeString()}`\n      }\n    ]\n  }\n);\n\n// 결과 반환\nreturn {blocks: slackBlocks};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1080,-320],"id":"0b1fdbad-61b1-4287-aae5-66a769d6ae66","name":"My Jira To Slack Message"},{"parameters":{"select":"channel","channelId":{"__rl":true,"value":"={{$node[\"Slack jira_status Webhook\"].json.body.channel_id}}","mode":"id"},"messageType":"block","blocksUi":"={{ $json.blocks }}","text":"= ","otherOptions":{}},"type":"n8n-nodes-base.slack","typeVersion":2.3,"position":[1300,-320],"id":"e53c9039-4ac2-4b9f-ac95-0a63b0aafa4e","name":"Slack","webhookId":"9fe89c7c-b2e2-4562-8c45-c603b997a890","credentials":{"slackApi":{"id":"Bqw9EwOIkH7skn99","name":"PMS BOT"}}},{"parameters":{"content":"📊 JIRA-Slack 자동화 워크플로우 🔄\n\n이 n8n 워크플로우는 Slack에서 특정 명령어를 입력하면 담당자의 JIRA 작업 현황을 \n자동으로 수집하여 보고서 형태로 Slack에 보내주는 자동화 시스템입니다.\n\n🔹 주요 구성 요소:\n  🎣 Slack 웹훅: 지정된 경로로 Slack 명령어 수신\n  🔍 JIRA 검색: 특정 담당자의 미완료 작업(Story, Bug) 조회\n  💻 코드 노드: JIRA 데이터를 Slack 메시지 형식으로 변환\n  📢 Slack 발신: 포맷된 작업 현황 보고서를 채널에 전송\n\n⚡ 작업 상태 구분:\n  🔶 IN PROGRESS - 진행 중인 작업\n  🔷 TO DO - 앞으로 할 작업\n\n🎯 우선순위 표시:\n  🔴 Highest  🟠 High  🟡 Medium  🟢 Low  🔵 Lowest","height":600,"width":1020},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[510,-760],"id":"ffea2c94-9773-4865-8342-71aa3ba88b4d","name":"Sticky Note"}],"connections":{"Slack jira_status Webhook":{"main":[[{"node":"Jira Search","type":"main","index":0}]]},"Jira Search":{"main":[[{"node":"My Jira To Slack Message","type":"main","index":0}]]},"My Jira To Slack Message":{"main":[[{"node":"Slack","type":"main","index":0}]]},"Slack":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"ab7f4a23-71a3-4a91-871b-b7456af3d703","triggerCount":1,"tags":[],"safeName":"PMS Bot Slash Command"}