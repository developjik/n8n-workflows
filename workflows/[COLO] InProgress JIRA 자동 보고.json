{"createdAt":"2025-04-16T04:22:08.092Z","updatedAt":"2025-05-12T02:10:34.000Z","id":"4mvHVAF3QOFaqLZT","name":"[COLO] InProgress JIRA 자동 보고","active":true,"nodes":[{"parameters":{"select":"channel","channelId":{"__rl":true,"value":"={{$node[\"Set Excel Row Variables\"].json.slack_chat}}","mode":"id"},"messageType":"block","blocksUi":"={{ $json }}","text":"= ","otherOptions":{}},"type":"n8n-nodes-base.slack","typeVersion":2.3,"position":[2000,200],"id":"2f3553e7-994b-4132-97a1-4427afa21a48","name":"Slack","webhookId":"9fe89c7c-b2e2-4562-8c45-c603b997a890","credentials":{"slackApi":{"id":"Bqw9EwOIkH7skn99","name":"PMS BOT"}}},{"parameters":{"rule":{"interval":[{"field":"weeks","triggerAtDay":[1,2,3,4,5],"triggerAtHour":9}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-420,175],"id":"df555a2d-6360-4cf1-864d-9412de584355","name":"09:00 Trigger"},{"parameters":{"content":"## 📌 JIRA 담당자별 진행중 작업 자동 보고 워크플로우\n\n이 워크플로우는 Google Spreadsheet에 정의된 각 담당자의 Jira 작업을 조회하여,  \n**진행 중인 작업이 있을 경우 Slack 채널로 자동 보고**합니다.\n\n---\n\n### 🧩 주요 구성\n\n- **09:00 Trigger**  \n  매주 평일(월~금) 오전 9시에 워크플로우 실행\n\n- **Get COLO Variables**  \n  환경변수 (예: JIRA 도메인 등)를 별도 워크플로우에서 가져옴\n\n- **Google Spreadsheet Row 수집**  \n  담당자 이름, Slack 채널 ID, Slack 그룹 ID 등의 메타데이터 불러오기\n\n- **Jira 이슈 조회**  \n  `In Progress` 상태의 Story 또는 Bug 이슈만 필터링\n\n- **조건 분기 (IF 노드)**  \n  - 이슈가 **있을 경우**: 상세 이슈 블록 구성 후 Slack 메시지 전송  \n  - 이슈가 **없을 경우**: \"현재 진행 중 작업 없음\" 메시지 전송\n\n- **Slack 메시지 전송**  \n  채널 지정 및 `<subteam>` ID를 통한 그룹 멘션 포함 메시지 전송\n\n---\n\n### 🧾 메시지 포맷\n\n- 이슈별로 블록 형태로 구성된 시각적 메시지\n- 상태, 우선순위, 담당자, 요약, 마감일 등 주요 정보 포함\n- 이슈 없을 경우에도 동일한 포맷의 공지 메시지 발송\n- 마지막에 Slack Mentions (`<!subteam^ID>`) 포함\n\n---\n\n> 📣 이 워크플로우는 팀 단위 Jira 상태 관리를 자동화하고  \n> 반복적인 Slack 보고를 줄이는 데 효과적입니다.","height":1300,"width":2900},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-700,-820],"id":"518d00a1-2ab2-4220-bcb8-82ebf6feb6de","name":"Sticky Note"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[680,175],"id":"c7598f81-a987-4201-b0c2-a9494777ad26","name":"Loop Over Items"},{"parameters":{"jsCode":"return $input.first().json.data;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[460,175],"id":"e9156dbc-da95-49b1-a355-b170501893a6","name":"Get Excel Row Data"},{"parameters":{"operation":"getAll","returnAll":true,"options":{"jql":"=assignee = {{ $json.name }} AND issuetype IN (Story, Bug) AND statusCategory = \"In Progress\""}},"id":"8d0b159c-c8e3-4d68-abfe-c160b22bbb81","name":"Get Developer Jira Issues","type":"n8n-nodes-base.jira","position":[1120,100],"typeVersion":1,"alwaysOutputData":true,"credentials":{"jiraSoftwareCloudApi":{"id":"jd9f8LcXIUpGLHG7","name":"Colo Developjik1 Jira SW Cloud account"}}},{"parameters":{"workflowId":{"__rl":true,"value":"uGqCptWtD45pUJt4","mode":"list","cachedResultName":"[Sub] Get COLO Variables"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-200,175],"id":"0ab6853d-54f6-449d-84a0-52a22674861f","name":"Get COLO Variables"},{"parameters":{"assignments":{"assignments":[{"id":"de5132bb-1334-4c78-b840-2d404ea39dbd","name":"name","value":"={{ $json.name }}","type":"string"},{"id":"d9479c6f-2143-47e8-97b7-bd395836768c","name":"row_number","value":"={{ $json.row_number }}","type":"string"},{"id":"79e18502-1172-44da-83d9-cfdb42da4100","name":"slack_chat","value":"={{ $json.slack_chat }}","type":"string"},{"id":"c01d0647-1dae-4118-b2be-098c26da3806","name":"slack_group","value":"={{ $json.slack_group }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[900,100],"id":"0477679f-3683-43cf-bccb-ec7be8ddd3be","name":"Set Excel Row Variables"},{"parameters":{"jsCode":"const items = $input.all();\nconst JIRA_DOMAIN = $node['Get COLO Variables'].json.jira_domain;\n\n// 이모지 매핑\nconst PRIORITY_EMOJI = {\n  Highest: '🔴',\n  High: '🟠',\n  Medium: '🟡',\n  Low: '🟢',\n  Lowest: '🔵'\n};\n\nconst ISSUE_TYPE_EMOJI = {\n  Bug: '🐞',\n  Story: '📝',\n  Task: '✅',\n  Epic: '🏆',\n  'Sub-task': '📎'\n};\n\n// 날짜 포맷\nconst today = new Date();\nconst formattedDate = `${today.getFullYear()}년 ${today.getMonth() + 1}월 ${today.getDate()}일`;\n\n// 블록 배열\nconst blocks = [];\n\n// 이슈 블록 생성\nfunction formatIssueBlock(issue, index) {\n  const type = issue.fields?.issuetype?.name || 'Task';\n  const priority = issue.fields?.priority?.name || 'None';\n  const assignee = issue.fields?.assignee?.displayName || 'Unassigned';\n  const summary = issue.fields?.summary || '(제목 없음)';\n  let desc = (issue.fields?.description || '').split('\\n')[0]\n    .replace(/\\*|_/g, '')\n    .replace(/\\[.*?\\|.*?$/g, '')\n    .substring(0, 80);\n  const dueDate = issue.fields?.duedate ? `⏰ *마감일:* ${issue.fields.duedate}` : null;\n\n  const sectionBlock = {\n    type: 'section',\n    text: {\n      type: 'mrkdwn',\n      text: `*${index + 1}.* ${ISSUE_TYPE_EMOJI[type] || '📄'} ${PRIORITY_EMOJI[priority] || '⚪️'} *<${JIRA_DOMAIN}/browse/${issue.key}|${issue.key}>: ${summary}*`\n    }\n  };\n\n  const context = [\n    { type: 'mrkdwn', text: `*상태:* ${issue.fields?.status?.name || '미정'}` },\n    { type: 'mrkdwn', text: `*우선순위:* ${priority}` },\n    { type: 'mrkdwn', text: `*담당자:* ${assignee}` }\n  ];\n  if (desc) context.push({ type: 'mrkdwn', text: `💬 ${desc}` });\n  if (dueDate) context.push({ type: 'mrkdwn', text: dueDate });\n\n  return [sectionBlock, { type: 'context', elements: context.slice(0, 10) }, { type: 'divider' }];\n}\n\n// 이슈 필터링\nconst allIssues = items.map(item => item.json);\nconst inProgress = allIssues.filter(i => i.fields?.statusCategory?.key === 'indeterminate');\n\n// 메시지 구성\nblocks.push({\n  type: 'header',\n  text: { type: 'plain_text', text: `📊 ${$('Set Excel Row Variables').first().json.name} IN PROGRESS JIRA 작업 현황 보고 (${formattedDate} 기준)`, emoji: true }\n});\nblocks.push({ type: 'divider' });\n\nblocks.push({\n  type: 'section',\n  text: { type: 'mrkdwn', text: `*🔶 진행 중인 작업 (IN PROGRESS)* - 총 ${inProgress.length}건` }\n});\n\ninProgress.forEach((issue, idx) => {\n  const blocksForIssue = formatIssueBlock(issue, idx);\n  blocks.push(...blocksForIssue);\n});\n\nblocks.push(\n  {\n    type: 'header',\n    text: { type: 'plain_text', text: '📌 요약', emoji: true }\n  },\n  {\n    type: 'section',\n    fields: [\n      { type: 'mrkdwn', text: `*진행 중 작업:*\\n${inProgress.length}건` }\n    ]\n  },\n  {\n    type: 'context',\n    elements: [{ type: 'mrkdwn', text: `⏱️ 보고서 생성 시간: ${today.toLocaleTimeString()}` }]\n  },\n   {\n    type: 'section',\n    text: {\n      type: 'mrkdwn',\n      text: `<!subteam^${$node[\"Set Excel Row Variables\"].json.slack_group}> 확인 부탁드립니다.`\n    }\n  }\n);\n\nreturn { blocks };"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1780,0],"id":"6d59d161-34fb-4ed4-a083-83a25fe67d85","name":"Jira Issue To Slack Message"},{"parameters":{"jsCode":"const today = new Date();\nconst formattedDate = `${today.getFullYear()}년 ${today.getMonth() + 1}월 ${today.getDate()}일`;\n\nconst blocks = [\n  {\n    type: 'header',\n    text: {\n      type: 'plain_text',\n      text: `📊 ${$('Set Excel Row Variables').first().json.name} IN PROGRESS JIRA 작업 현황 보고 (${formattedDate} 기준)`,\n      emoji: true\n    }\n  },\n  { type: 'divider' },\n  {\n    type: 'section',\n    text: {\n      type: 'mrkdwn',\n      text: `*🔶 진행 중인 작업 (IN PROGRESS)* - 총 0건`\n    }\n  },\n  {\n    type: 'section',\n    text: {\n      type: 'mrkdwn',\n      text: `📭 현재 진행 중인 작업이 없습니다.`\n    }\n  },\n  { type: 'divider' },\n  {\n    type: 'header',\n    text: { type: 'plain_text', text: '📌 요약', emoji: true }\n  },\n  {\n    type: 'section',\n    fields: [\n      { type: 'mrkdwn', text: `*진행 중 작업:*\\n0건` }\n    ]\n  },\n  {\n    type: 'context',\n    elements: [{ type: 'mrkdwn', text: `⏱️ 보고서 생성 시간: ${today.toLocaleTimeString()}` }]\n  },\n  {\n    type: 'section',\n    text: {\n      type: 'mrkdwn',\n      text: `<!subteam^${$node[\"Set Excel Row Variables\"].json.slack_group}> 확인 부탁드립니다.`\n    }\n  }\n];\n\nreturn { blocks };"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1780,200],"id":"1ad6d5d3-cb7b-48fd-bc93-6d45524d3810","name":"Jira No Issue To Slack Message"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d5cfd519-4fee-4455-a8e2-bde82d140131","leftValue":"={{$node[\"Get Developer Jira Issues\"].json}}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1360,100],"id":"41f7bfb5-31d3-4562-8355-e1fe50f04f57","name":"If"},{"parameters":{"assignments":{"assignments":[{"id":"71e02481-915d-4ed9-9777-524070b45195","name":"spreadsheet_id","value":"1XfX5rudDarTzGtcS9gpQNjuGFr5N-H9JbuPsub3fdCY","type":"string"},{"id":"cc7bf0c9-fdbc-4f26-b2ac-3cd68bb1f31e","name":"tab_name","value":"Jira Task Status Cron","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[20,175],"id":"ff8d4fc9-c397-43da-9e16-2bf7ab2eddcc","name":"Set JIRA Task Sheet Variables"},{"parameters":{"workflowId":{"__rl":true,"value":"hj1Qpz1LUngjnHW5","mode":"list","cachedResultName":"[Sub] Google Spreadsheet Data Fetch using Opensheet"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[240,175],"id":"18a47204-12c5-41a7-9f1a-1ffe9304a1b8","name":"Execute JIRA Task Sheet"}],"connections":{"09:00 Trigger":{"main":[[{"node":"Get COLO Variables","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Set Excel Row Variables","type":"main","index":0}]]},"Get Excel Row Data":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Get Developer Jira Issues":{"main":[[{"node":"If","type":"main","index":0}]]},"Slack":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Get COLO Variables":{"main":[[{"node":"Set JIRA Task Sheet Variables","type":"main","index":0}]]},"Set Excel Row Variables":{"main":[[{"node":"Get Developer Jira Issues","type":"main","index":0}]]},"Jira Issue To Slack Message":{"main":[[{"node":"Slack","type":"main","index":0}]]},"Jira No Issue To Slack Message":{"main":[[{"node":"Slack","type":"main","index":0}]]},"If":{"main":[[{"node":"Jira Issue To Slack Message","type":"main","index":0}],[{"node":"Jira No Issue To Slack Message","type":"main","index":0}]]},"Set JIRA Task Sheet Variables":{"main":[[{"node":"Execute JIRA Task Sheet","type":"main","index":0}]]},"Execute JIRA Task Sheet":{"main":[[{"node":"Get Excel Row Data","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:09:00 Schedule Trigger":{"recurrenceRules":[]},"node:17:00 Schedule Trigger":{"recurrenceRules":[]},"node:09:00 Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"600d88af-022d-4bf4-bce7-89d105967c5e","triggerCount":1,"tags":[]}